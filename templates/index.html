{% extends "base.html" %}

{% block favicon_stylesheet %} {{ super() }} {% endblock %}
{% block title %} {{ super() }} {% endblock %}

{% block body %}
    <div id="project-section">
        {% include "flash_messages.html" %}
        <div class="project-dir-path">
            Project directory: <span class="path">{{ path }}</span>
        </div>
    </div>

    <div id="takeout-section" data-full="{{ 'True' if db else '' }}">
        <div id="buttons">
            <div id="takeout-buttons">
                    <button id="takeout-setup-button" class="button">Add Takeout</button>
                    <button id="update-records-button" class="button" {{ 'disabled' if not db else '' }}>
                        Update existing records</button>
                    <button id="takeout-cancel-button" class="button-cancel hidden">Stop</button>
            </div>
            <button id="new-project-button" class="button">New project</button>
        </div>
        <div id="takeout-setup" class="{{ 'hidden' if db else '' }}">
            <form id="takeout-form" class="single-field-form-inputs"
                  action="{{ url_for('records.populate_db_form') }}" method="POST">
                <input id="takeout-input" name="takeout-dir" placeholder="Takeout path" required>
                <input class="button" type="submit" value="Start">
            </form>
            {% include "help/takeout_help.html" %}
        </div>
        <div id="db-progress">
            <div id="progress-bar-container">
                <div id="progress-bar-rectangle">
                    <div id="progress-bar"></div>
                    <div id="progress-bar-text"><span></span></div>
                </div>
            </div>
            <div id="progress-msg"></div>
            <div id="wait-for-db"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vega@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@3"></script>
    <div id="visualization"></div>
    <script type="text/javascript">
        let spec = JSON.parse('{{ plot_data | tojson |  safe }}');  /* JSON dump of your chart's spec */
        let opt = {"renderer": "svg", "actions": false};  /* Options for the embedding */
        vegaEmbed("#visualization", spec, opt).then(function(data) {
            data.view.width(window.screen.width - 38 - 44 - 20);
            // 38 is padding set by vega-embed class, 44 is added to the canvas/svg size, not sure by what
            data.view.runAsync();
        });
    </script>
    </script>
{% endblock %}